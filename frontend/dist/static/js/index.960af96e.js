(()=>{"use strict";var e={674:function(e,s,a){var t=a(893),r=a(745),n=a(294);let i="http://localhost:8080/api",l=e=>{let{citizen:s,onBack:a}=e;return s.address?(0,t.jsxs)("div",{className:"address-page-container",children:[(0,t.jsx)("h2",{className:"address-title",children:"Address Details"}),(0,t.jsxs)("ul",{className:"address-details",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{className:"address-label",children:"Street:"}),(0,t.jsx)("span",{className:"address-value",children:s.address.street})]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{className:"address-label",children:"City:"}),(0,t.jsx)("span",{className:"address-value",children:s.address.city})]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{className:"address-label",children:"Zip Code:"}),(0,t.jsx)("span",{className:"address-value",children:s.address.zipCode})]})]}),(0,t.jsx)("button",{className:"address-back-btn",onClick:a,children:"Back"})]}):(0,t.jsxs)("div",{className:"address-page-container",children:[(0,t.jsx)("h2",{className:"address-title",children:"Address Details"}),(0,t.jsx)("p",{style:{textAlign:"center"},children:"No address information available."}),(0,t.jsx)("button",{className:"address-back-btn",onClick:a,children:"Back"})]})},c=e=>0===e?"☀️":e>=1&&e<=3?"⛅️":e>=45&&e<=48?"\uD83C\uDF2B️":e>=61&&e<=67||e>=80&&e<=82?"\uD83C\uDF27️":e>=71&&e<=77?"❄️":e>=95&&e<=99?"⛈️":"\uD83C\uDF0D",o=e=>{let{weather:s,city:a}=e;if(!a)return null;if(!s)return(0,t.jsxs)("div",{className:"weather-widget",children:["Loading weather for ",a,"..."]});let{temperature:r,windspeed:n,weathercode:i}=s.current_weather,l=c(i);return(0,t.jsxs)("div",{className:"weather-widget",children:[(0,t.jsxs)("h4",{children:["Weather in ",a]}),(0,t.jsxs)("div",{className:"weather-details",children:[(0,t.jsx)("span",{className:"weather-icon",children:l}),(0,t.jsxs)("span",{className:"weather-temp",children:[r.toFixed(1),"\xb0C"]}),(0,t.jsxs)("span",{className:"weather-wind",children:["\uD83D\uDCA8 ",n," km/h"]})]})]})},d=e=>{let{holidays:s,countryCode:a}=e;if(!s||0===s.length)return(0,t.jsx)("div",{className:"widget-container",children:"Loading holidays..."});let r=s.filter(e=>new Date(e.date)>=new Date).slice(0,4);return(0,t.jsxs)("div",{className:"widget-container",children:[(0,t.jsxs)("h4",{children:["Upcoming Public Holidays in ",a.toUpperCase()]}),(0,t.jsx)("ul",{className:"holidays-list",children:r.map(e=>(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{className:"holiday-date",children:new Date(e.date).toLocaleDateString("en-GB")}),(0,t.jsx)("span",{className:"holiday-name",children:e.localName})]},e.date))})]})},h=()=>{let e=localStorage.getItem("jwt");if(!e)return"";try{var s;let a=null==(s=JSON.parse(atob(e.split(".")[1])).roles[0])?void 0:s.authority;if(a&&"string"==typeof a)return a.replace("ROLE_","");return""}catch(e){return console.error("Failed to decode JWT:",e),""}};async function u(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=localStorage.getItem("jwt"),t=new Headers(s.headers||{});a&&t.set("Authorization",`Bearer ${a}`),t.set("Content-Type","application/json");let r=await fetch(e,{...s,headers:t});if(!r.ok){if(401===r.status||403===r.status)throw localStorage.removeItem("jwt"),window.location.reload(),Error("Session expired. Please login again.");let e=await r.text();throw Error(`Request failed: ${e}`)}return 204===r.status?null:r.json()}let m={firstName:"",lastName:"",passportNumber:"",address:{street:"",city:"",zipCode:""}},p=()=>{let[e,s]=(0,n.useState)([]),[a,r]=(0,n.useState)(null),[c,p]=(0,n.useState)(""),[x,j]=(0,n.useState)(""),[N,g]=(0,n.useState)(null),[v,f]=(0,n.useState)(m),[y,b]=(0,n.useState)([]),[w,C]=(0,n.useState)(null),[S,k]=(0,n.useState)(null),D=e=>{e&&u("ADMIN"===e?`${i}/citizens`:`${i}/citizens/username`).then(a=>{let t="ADMIN"===e?a:[a];if(s(t),"USER"===e&&t.length>0){var r;let e=null==(r=t[0].address)?void 0:r.city;e&&(k(e),u(`${i}/weather/my-city`).then(C).catch(e=>console.error("Failed to fetch weather:",e)))}}).catch(e=>p(e.message))};(0,n.useEffect)(()=>{let e=h();j(e),fetch(`${i}/public/holidays/PL`).then(e=>e.ok?e.json():[]).then(b).catch(e=>console.error("Error fetching holidays:",e)),D(e)},[]);let z=e=>{if(!e)return void alert("Cannot delete a citizen with an empty passport number.");window.confirm("Are you sure?")&&u(`${i}/citizens/passport/${e}`,{method:"DELETE"}).then(()=>D(x)).catch(e=>alert(e.message))},O=e=>{g(e.passportNumber),f({...e,address:e.address||m.address})},A=()=>{g(null),f(m)},E=e=>{let{name:s,value:a}=e.target;["street","city","zipCode"].includes(s)?f(e=>({...e,address:{...e.address,[s]:a}})):f(e=>({...e,[s]:a}))};return a?(0,t.jsx)(l,{citizen:a,onBack:()=>r(null)}):c?(0,t.jsx)("div",{className:"error",style:{color:"red"},children:c}):(0,t.jsxs)("div",{className:"citizen-table-container",children:["USER"===x?(0,t.jsx)(o,{weather:w,city:S}):(0,t.jsx)(d,{holidays:y,countryCode:"PL"}),(0,t.jsxs)("div",{className:"table-header",children:[(0,t.jsx)("h2",{className:"citizen-table-title",children:"Citizens Data"}),(0,t.jsx)("button",{className:"logout-btn",onClick:()=>{localStorage.removeItem("jwt"),window.location.reload()},children:"Logout"})]}),"ADMIN"===x&&N&&(0,t.jsx)("div",{className:"modal-backdrop",children:(0,t.jsxs)("div",{className:"modal",children:[(0,t.jsx)("h3",{children:"Update Citizen"}),(0,t.jsx)("input",{type:"text",name:"firstName",value:v.firstName,onChange:E,placeholder:"First Name"}),(0,t.jsx)("input",{type:"text",name:"lastName",value:v.lastName,onChange:E,placeholder:"Last Name"}),(0,t.jsx)("input",{type:"text",name:"passportNumber",value:v.passportNumber,readOnly:!0,disabled:!0}),(0,t.jsx)("h4",{style:{marginTop:"15px",marginBottom:"5px",color:"#555"},children:"Address"}),(0,t.jsx)("input",{type:"text",name:"street",value:v.address.street,onChange:E,placeholder:"Street"}),(0,t.jsx)("input",{type:"text",name:"city",value:v.address.city,onChange:E,placeholder:"City"}),(0,t.jsx)("input",{type:"text",name:"zipCode",value:v.address.zipCode,onChange:E,placeholder:"Zip Code"}),(0,t.jsxs)("div",{className:"modal-actions",children:[(0,t.jsx)("button",{className:"action-btn",onClick:()=>{if(N){if(!v.firstName.trim()||!v.lastName.trim()||!v.passportNumber.trim())return void alert("Fields cannot be empty.");u(`${i}/citizens/passport/${N}`,{method:"PUT",body:JSON.stringify(v)}).then(()=>{A(),D(x)}).catch(e=>alert(e.message))}},children:"Save Changes"}),(0,t.jsx)("button",{className:"action-btn cancel-btn",onClick:A,children:"Cancel"})]})]})}),(0,t.jsx)("ul",{className:"citizen-list",children:e.map(e=>(0,t.jsxs)("li",{className:"citizen-list-item",children:[(0,t.jsxs)("div",{className:"citizen-info",children:[(0,t.jsxs)("span",{className:"citizen-name",children:[e.firstName," ",e.lastName]}),(0,t.jsxs)("span",{className:"citizen-passport",children:["(",e.passportNumber,")"]})]}),(0,t.jsxs)("div",{className:"citizen-actions",children:[(0,t.jsx)("a",{href:"#",className:"show-address-link",onClick:()=>r(e),children:"Show Address"}),"ADMIN"===x&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{className:"action-btn update-btn",onClick:()=>O(e),children:"Update"}),(0,t.jsx)("button",{className:"action-btn delete-btn",onClick:()=>z(e.passportNumber),children:"Delete"})]})]})]},e.passportNumber||`citizen-${e.id}`))})]})},x=e=>{let{onLogin:s,onSwitchToRegister:a}=e,[r,l]=(0,n.useState)(""),[c,o]=(0,n.useState)(""),[d,h]=(0,n.useState)(""),u=async e=>{e.preventDefault(),h("");try{let e=await fetch(`${i}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r,password:c})}),a=await e.text();if(!e.ok)throw Error(a||"Invalid credentials");localStorage.setItem("jwt",a),s()}catch(e){h(e.message)}};return(0,t.jsx)("div",{className:"login-container",children:(0,t.jsxs)("form",{className:"login-form",onSubmit:u,children:[(0,t.jsx)("h2",{children:"Login"}),d&&(0,t.jsx)("div",{className:"message error-message",children:d}),(0,t.jsx)("input",{type:"text",value:r,onChange:e=>l(e.target.value),placeholder:"Username",required:!0}),(0,t.jsx)("input",{type:"password",value:c,onChange:e=>o(e.target.value),placeholder:"Password",required:!0}),(0,t.jsx)("button",{type:"submit",className:"submit-btn",children:"Login"}),(0,t.jsxs)("p",{className:"switch-link",children:["Don't have an account? ",(0,t.jsx)("a",{href:"#",onClick:e=>{e.preventDefault(),a()},children:"Register here"})]})]})})},j={username:"",password:"",firstName:"",lastName:"",passportNumber:"",street:"",city:"",zipCode:""},N=e=>{let{onSwitchToLogin:s}=e,[a,r]=(0,n.useState)(j),[l,c]=(0,n.useState)(""),[o,d]=(0,n.useState)(""),h=e=>{r({...a,[e.target.name]:e.target.value})},u=async e=>{if(e.preventDefault(),c(""),d(""),a.password.length<6)return void c("Password must be at least 6 characters long.");try{let e=await fetch(`${i}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),t=await e.text();if(!e.ok)try{let e=JSON.parse(t);throw Error(e.message||"Registration failed.")}catch{throw Error(t||"Registration failed.")}d("Registration successful! You can now log in."),r(j),setTimeout(()=>{s()},3e3)}catch(s){let e=s.message||"";e.includes("passport_number")&&e.includes("Duplicate entry")?c("Passport number is already registered."):e.includes("username")&&e.includes("Duplicate entry")?c("Username is already taken."):c(e)}};return(0,t.jsx)("div",{className:"registration-container",children:(0,t.jsxs)("form",{className:"registration-form",onSubmit:u,children:[(0,t.jsx)("h2",{children:"Register"}),l&&(0,t.jsx)("div",{className:"message error-message",children:l}),o&&(0,t.jsx)("div",{className:"message success-message",children:o}),(0,t.jsxs)("div",{className:"form-section",children:[(0,t.jsx)("h4",{children:"Account Details"}),(0,t.jsx)("input",{name:"username",value:a.username,onChange:h,placeholder:"Username",required:!0}),(0,t.jsx)("input",{name:"password",type:"password",value:a.password,onChange:h,placeholder:"Password",required:!0})]}),(0,t.jsxs)("div",{className:"form-section",children:[(0,t.jsx)("h4",{children:"Personal Information"}),(0,t.jsx)("input",{name:"firstName",value:a.firstName,onChange:h,placeholder:"First Name",required:!0}),(0,t.jsx)("input",{name:"lastName",value:a.lastName,onChange:h,placeholder:"Last Name",required:!0}),(0,t.jsx)("input",{name:"passportNumber",value:a.passportNumber,onChange:h,placeholder:"Passport Number",required:!0})]}),(0,t.jsxs)("div",{className:"form-section",children:[(0,t.jsx)("h4",{children:"Address"}),(0,t.jsx)("input",{name:"street",value:a.street,onChange:h,placeholder:"Street",required:!0}),(0,t.jsx)("input",{name:"city",value:a.city,onChange:h,placeholder:"City",required:!0}),(0,t.jsx)("input",{name:"zipCode",value:a.zipCode,onChange:h,placeholder:"Zip Code",required:!0})]}),(0,t.jsx)("button",{type:"submit",className:"submit-btn",children:"Register"}),(0,t.jsxs)("p",{className:"switch-link",children:["Already have an account? ",(0,t.jsx)("a",{href:"#",onClick:e=>{e.preventDefault(),s()},children:"Login here"})]})]})})},g=async()=>{let e=localStorage.getItem("jwt");if(!e)return!1;try{return(await fetch(`${i}/citizens/username`,{headers:{Authorization:`Bearer ${e}`}})).ok}catch{return!1}};(0,r.createRoot)(document.getElementById("root")).render((0,t.jsx)(()=>{let[e,s]=(0,n.useState)(!1),[a,r]=(0,n.useState)(!0),[i,l]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{g().then(e=>{s(e),r(!1)})},[]),a)?(0,t.jsx)("div",{style:{textAlign:"center",marginTop:"50px"},children:"Loading..."}):e?(0,t.jsx)(p,{}):i?(0,t.jsx)(x,{onLogin:()=>{s(!0)},onSwitchToRegister:()=>l(!1)}):(0,t.jsx)(N,{onSwitchToLogin:()=>l(!0)})},{}))}},s={};function a(t){var r=s[t];if(void 0!==r)return r.exports;var n=s[t]={exports:{}};return e[t](n,n.exports,a),n.exports}a.m=e,a.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s),(()=>{var e=[];a.O=(s,t,r,n)=>{if(t){n=n||0;for(var i=e.length;i>0&&e[i-1][2]>n;i--)e[i]=e[i-1];e[i]=[t,r,n];return}for(var l=1/0,i=0;i<e.length;i++){for(var[t,r,n]=e[i],c=!0,o=0;o<t.length;o++)(!1&n||l>=n)&&Object.keys(a.O).every(e=>a.O[e](t[o]))?t.splice(o--,1):(c=!1,n<l&&(l=n));if(c){e.splice(i--,1);var d=r();void 0!==d&&(s=d)}}return s}})(),a.rv=()=>"1.3.11",(()=>{var e={980:0};a.O.j=s=>0===e[s];var s=(s,t)=>{var r,n,[i,l,c]=t,o=0;if(i.some(s=>0!==e[s])){for(r in l)a.o(l,r)&&(a.m[r]=l[r]);if(c)var d=c(a)}for(s&&s(t);o<i.length;o++)n=i[o],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(d)},t=self.webpackChunkcivio_frontend=self.webpackChunkcivio_frontend||[];t.forEach(s.bind(null,0)),t.push=s.bind(null,t.push.bind(t))})(),a.ruid="bundler=rspack@1.3.11";var t=a.O(void 0,["361"],function(){return a(674)});t=a.O(t)})();